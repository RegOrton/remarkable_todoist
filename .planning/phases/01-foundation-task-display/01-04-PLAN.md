---
phase: 01-foundation-task-display
plan: 04
type: execute
wave: 3
depends_on: ["01-02", "01-03"]
files_modified:
  - src/main.cpp
  - src/controllers/appcontroller.h
  - src/controllers/appcontroller.cpp
autonomous: false

user_setup:
  - service: todoist
    why: "API access for fetching tasks"
    env_vars:
      - name: TODOIST_API_TOKEN
        source: "Todoist Settings -> Integrations -> Developer -> API token (copy the token shown)"
    dashboard_config:
      - task: "No configuration needed"
        location: "Token is automatically available in Todoist settings"

must_haves:
  truths:
    - "User can launch app and see their Todoist tasks"
    - "Tasks display name, due date, project, and priority"
    - "User can scroll through task list"
    - "App loads API token from config on startup"
    - "Checkboxes are visible next to each task"
  artifacts:
    - path: "src/controllers/appcontroller.h"
      provides: "Application orchestration"
      contains: "class AppController"
    - path: "src/main.cpp"
      provides: "Application entry point"
      contains: "AppController"
  key_links:
    - from: "src/controllers/appcontroller.cpp"
      to: "src/network/todoist_client.h"
      via: "fetches tasks"
      pattern: "TodoistClient"
    - from: "src/controllers/appcontroller.cpp"
      to: "src/models/taskmodel.h"
      via: "populates model"
      pattern: "TaskModel"
    - from: "src/controllers/appcontroller.cpp"
      to: "src/views/tasklistview.h"
      via: "displays tasks"
      pattern: "TaskListView"
---

<objective>
Wire all components together and create the complete working application.

Purpose: Integrates the data layer (TaskModel, Settings), network layer (TodoistClient), and UI layer (TaskListView, TaskDelegate) into a functioning application. This plan delivers the Phase 1 goal: user can view their Todoist tasks.

Output: Working remarkable-todoist application that loads API token, fetches tasks from Todoist, and displays them in a scrollable list.
</objective>

<execution_context>
@/home/reg/.claude/get-shit-done/workflows/execute-plan.md
@/home/reg/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-task-display/01-RESEARCH.md
@.planning/phases/01-foundation-task-display/01-01-SUMMARY.md
@.planning/phases/01-foundation-task-display/01-02-SUMMARY.md
@.planning/phases/01-foundation-task-display/01-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement AppController to orchestrate components</name>
  <files>
    src/controllers/appcontroller.h
    src/controllers/appcontroller.cpp
  </files>
  <action>
Create AppController class (src/controllers/appcontroller.h, appcontroller.cpp):

Purpose: Mediates between TodoistClient, TaskModel, and TaskListView. Handles startup flow, error display, and refresh orchestration.

Header:
- Include QObject, QWidget (for main window)
- Forward declare or include TodoistClient, TaskModel, TaskListView, AppSettings
- Class inherits QObject
- Q_OBJECT macro

Constructor:
- `AppController(QObject* parent = nullptr)`
- Create TaskModel (owned by controller)
- Create main QWidget as window container
- Create TaskListView, set TaskModel
- Create loading label (shown while fetching)
- Create error label (hidden by default)
- Layout: QVBoxLayout with TaskListView filling space

Methods:
- `void initialize()` - called after construction
  - Check AppSettings::hasApiToken()
  - If no token: show error message with instructions, return
  - Create TodoistClient with token
  - Connect signals: tasksFetched, projectsFetched, errorOccurred
  - First fetch projects (to get names), then fetch tasks
- `QWidget* mainWidget()` - returns the main window widget
- `void refresh()` - triggers task fetch (for future use)

Private slots:
- `void onProjectsFetched(const QMap<QString, QString>& projects)`
  - Store projects in TodoistClient (or member)
  - Trigger fetchAllTasks()
- `void onTasksFetched(const QVector<Task>& tasks)`
  - Hide loading indicator
  - Call taskModel->setTasks(tasks)
  - Show task list
- `void onError(const QString& error)`
  - Hide loading indicator
  - Show error label with message
  - qWarning() log

UI States:
- Loading: Show "Loading tasks..." label centered
- Error: Show error message label centered, hide task list
- Success: Show task list, hide loading/error

Flow:
1. initialize() checks for token
2. If token exists: show loading, fetch projects
3. On projects fetched: fetch tasks
4. On tasks fetched: populate model, show list
5. On error: show error message

Update CMakeLists.txt to include appcontroller.cpp
  </action>
  <verify>
Code compiles. AppController instantiates all components.
  </verify>
  <done>
AppController orchestrates startup: checks token, fetches projects, fetches tasks, populates model, handles errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update main.cpp to launch complete application</name>
  <files>
    src/main.cpp
  </files>
  <action>
Update src/main.cpp to use AppController:

```cpp
#include <QApplication>
#include "controllers/appcontroller.h"

int main(int argc, char *argv[])
{
    QApplication app(argc, argv);

    // Set application identity (for QSettings)
    QApplication::setOrganizationName("remarkable-todoist");
    QApplication::setApplicationName("Remarkable Todoist");

    // Create and initialize controller
    AppController controller;
    controller.initialize();

    // Get main widget and configure window
    QWidget* mainWindow = controller.mainWidget();
    mainWindow->setWindowTitle("Remarkable Todoist");

    // Set window size appropriate for reMarkable 2 (1404x1872 portrait)
    // For development, use smaller window; on device will be fullscreen
    mainWindow->resize(700, 900);

    mainWindow->show();

    return app.exec();
}
```

Window configuration notes:
- reMarkable 2 display: 1404x1872 pixels (portrait)
- For desktop development: 700x900 or similar aspect ratio
- On actual device: will likely run fullscreen
- No window decorations needed on device

If token is missing, the AppController::initialize() will show an error message directing user to create config file. User instructions:

```
To configure your API token:
1. Get your token from: https://todoist.com/app/settings/integrations/developer
2. Create config file: ~/.config/remarkable-todoist/config.ini
3. Add content:
   [auth]
   api_token=YOUR_TOKEN_HERE
4. Restart the application
```

This message should be shown in the UI when hasApiToken() returns false.
  </action>
  <verify>
`cmake -B build && cmake --build build` succeeds. Running `./build/remarkable-todoist` launches the application window.
  </verify>
  <done>
main.cpp creates QApplication, AppController, shows main window. Application launches and shows appropriate state (loading, error, or task list).
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Visual verification on desktop</name>
  <what-built>
Complete Phase 1 application: Qt 5.15 app that fetches Todoist tasks via API and displays them in a scrollable list with task name, due date, project, and priority. Checkboxes are visible (but not functional until Phase 2).
  </what-built>
  <how-to-verify>
Prerequisites:
1. Create config file with your Todoist API token:
   ```
   mkdir -p ~/.config/remarkable-todoist
   echo "[auth]" > ~/.config/remarkable-todoist/config.ini
   echo "api_token=YOUR_ACTUAL_TOKEN" >> ~/.config/remarkable-todoist/config.ini
   ```

2. Build and run the application:
   ```
   cd /home/reg/Remarkable_Todoist
   cmake -B build && cmake --build build
   ./build/remarkable-todoist
   ```

Verify:
1. Application launches without errors
2. Task list appears with your actual Todoist tasks
3. Each task shows:
   - Checkbox (square, 48x48px approximately)
   - Task name/title in bold
   - Project name (if assigned)
   - Due date (if set)
   - Priority indicator (P1-P4 if not default)
4. List is scrollable (if you have many tasks)
5. Text is high contrast (black on white)
6. Touch targets appear reasonably sized

If no token configured:
- App should show error message with instructions

If network error:
- App should show user-friendly error message
  </how-to-verify>
  <resume-signal>Type "approved" if task list displays correctly with your tasks, or describe any issues you observe</resume-signal>
</task>

</tasks>

<verification>
1. Application compiles and runs
2. With valid token: shows task list populated with real Todoist tasks
3. Without token: shows helpful error message with setup instructions
4. With invalid token: shows "Invalid API token" error
5. Tasks display: title, due date, project name, priority
6. Checkboxes visible (48x48 touch targets)
7. List scrolls smoothly
8. High contrast styling (black on white)
</verification>

<success_criteria>
Phase 1 requirements satisfied:
- AUTH-01: API token stored in config file
- AUTH-02: Token loaded on startup
- DISP-01: Tasks shown in scrollable list
- DISP-02: Task name displayed
- DISP-03: Due date displayed
- DISP-04: Project name displayed
- DISP-05: Priority indicator displayed (P1-P4)
- DISP-06: Checkbox visible next to each task

Success criteria from roadmap:
1. User can launch app (verified by desktop test)
2. User sees tasks with name, due date, project, priority
3. Token loads from config automatically
4. High contrast display (verified visually)
5. Scrollable list (verified by scroll test)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-task-display/01-04-SUMMARY.md`
</output>
