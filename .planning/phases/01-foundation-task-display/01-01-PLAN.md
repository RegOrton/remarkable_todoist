---
phase: 01-foundation-task-display
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - CMakeLists.txt
  - .gitignore
  - src/main.cpp
  - src/models/task.h
  - src/models/task.cpp
  - src/models/taskmodel.h
  - src/models/taskmodel.cpp
  - src/config/settings.h
  - src/config/settings.cpp
autonomous: true

must_haves:
  truths:
    - "Project compiles with Qt 5.15"
    - "Task data structure exists with all required fields"
    - "TaskModel can store and retrieve tasks"
    - "Settings can store and load API token"
  artifacts:
    - path: "CMakeLists.txt"
      provides: "Qt 5.15 build configuration"
      contains: "find_package(Qt5"
    - path: "src/models/task.h"
      provides: "Task data structure"
      contains: "struct Task"
    - path: "src/models/taskmodel.h"
      provides: "Qt list model for tasks"
      contains: "class TaskModel : public QAbstractListModel"
    - path: "src/config/settings.h"
      provides: "API token storage"
      contains: "getApiToken"
  key_links:
    - from: "src/models/taskmodel.cpp"
      to: "src/models/task.h"
      via: "includes Task struct"
      pattern: "#include.*task\\.h"
---

<objective>
Create the foundational project structure with Qt 5.15 build system, data models, and configuration storage.

Purpose: Establishes the core data layer that all other components depend on. The Task struct, TaskModel, and Settings are the foundation for network, UI, and integration layers.

Output: Compilable Qt 5.15 project with Task data model (QAbstractListModel), Settings module for API token, and proper project structure.
</objective>

<execution_context>
@/home/reg/.claude/get-shit-done/workflows/execute-plan.md
@/home/reg/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-task-display/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Qt 5.15 project structure and build system</name>
  <files>
    CMakeLists.txt
    .gitignore
    src/main.cpp
  </files>
  <action>
Create the project structure following the research-recommended layout:
```
src/
├── main.cpp
├── models/
├── views/
├── controllers/
├── network/
└── config/
```

Create CMakeLists.txt:
- Require CMake 3.16+
- Find Qt5 components: Widgets, Network
- Set C++17 standard
- Enable Qt AUTOMOC, AUTOUIC, AUTORCC
- Create executable target "remarkable-todoist"
- Add src/ directory sources
- Link Qt5::Widgets, Qt5::Network

Create .gitignore:
- Build directories (build/, cmake-build-*)
- IDE files (.idea/, *.user, .vscode/)
- Config files with tokens (~/.config/remarkable-todoist/)
- Qt generated files (moc_*, ui_*, qrc_*)
- Compiled objects (*.o, *.a, *.so)

Create src/main.cpp:
- Include QApplication
- Set application name "remarkable-todoist" and organization name
- Create QApplication instance
- Show simple "Hello reMarkable" QLabel as placeholder
- Return app.exec()

Directory structure: Create empty directories for models/, views/, controllers/, network/, config/
  </action>
  <verify>
Run `cmake -B build && cmake --build build` - should compile without errors and produce remarkable-todoist executable
  </verify>
  <done>
Project compiles successfully with Qt 5.15, produces executable, directory structure matches research recommendation
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement Task data structure and TaskModel</name>
  <files>
    src/models/task.h
    src/models/task.cpp
    src/models/taskmodel.h
    src/models/taskmodel.cpp
  </files>
  <action>
Create Task struct (src/models/task.h, task.cpp):
- QString id (Todoist task ID)
- QString title (task content/name)
- QString projectId
- QString projectName (denormalized for display)
- QDate dueDate (may be null/invalid for tasks without due date)
- int priority (1-4, where 4 is highest in Todoist API, but display as P1-P4 where P1=highest)
- bool completed
- Static method: `static Task fromJson(const QJsonObject& obj)` to parse Todoist API response
- Method: `QString priorityLabel() const` returns "P1", "P2", "P3", "P4" or empty for no priority
- Method: `QString dueDateDisplay() const` returns formatted date or empty string

Create TaskModel (src/models/taskmodel.h, taskmodel.cpp):
- Inherit from QAbstractListModel
- Define TaskRoles enum: TitleRole, DueDateRole, ProjectRole, PriorityRole, CompletedRole (starting at Qt::UserRole + 1)
- Store QVector<Task> m_tasks
- Implement required overrides:
  - `int rowCount(const QModelIndex& parent) const`
  - `QVariant data(const QModelIndex& index, int role) const`
  - `QHash<int, QByteArray> roleNames() const`
- Implement custom methods:
  - `void setTasks(const QVector<Task>& tasks)` - uses beginResetModel/endResetModel
  - `const Task& taskAt(int row) const`
  - `int taskCount() const`

Note on priority mapping: Todoist API uses 1=lowest, 4=highest. For UI display, invert: priority 4 -> "P1", priority 3 -> "P2", priority 2 -> "P3", priority 1 -> "P4".

Update CMakeLists.txt to include the new source files.
  </action>
  <verify>
Code compiles without errors. Can instantiate TaskModel in main.cpp temporarily, call setTasks with empty vector, verify rowCount returns 0.
  </verify>
  <done>
Task struct exists with all fields and JSON parsing. TaskModel implements QAbstractListModel correctly with proper role mappings.
  </done>
</task>

<task type="auto">
  <name>Task 3: Implement Settings module for API token storage</name>
  <files>
    src/config/settings.h
    src/config/settings.cpp
  </files>
  <action>
Create AppSettings class (src/config/settings.h, settings.cpp):
- Static class (no instances needed)
- Use QSettings with IniFormat, UserScope
- Organization: "remarkable-todoist", Application: "config"
- File location will be: ~/.config/remarkable-todoist/config.ini

Implement static methods:
- `static QString getApiToken()` - returns token from "auth/api_token" key
- `static void setApiToken(const QString& token)` - sets token, calls sync(), sets file permissions to 0600
- `static bool hasApiToken()` - returns !getApiToken().isEmpty()
- `static QString configFilePath()` - returns the path to config file (for debugging/user info)

For setApiToken:
- After settings.sync(), get filename with settings.fileName()
- Use QFile::setPermissions with QFileDevice::ReadOwner | QFileDevice::WriteOwner
- This ensures only the owner can read the API token

Update CMakeLists.txt to include the new source files.

Important: Do NOT hardcode any API tokens. The token will be configured by the user after installation.
  </action>
  <verify>
Code compiles. Can call AppSettings::configFilePath() in main.cpp to print expected config location. hasApiToken() returns false initially (no config exists).
  </verify>
  <done>
Settings module stores/retrieves API token using QSettings, config file path is correct (~/.config/remarkable-todoist/config.ini), file permissions set to 600 on write.
  </done>
</task>

</tasks>

<verification>
1. `cmake -B build && cmake --build build` completes without errors
2. `./build/remarkable-todoist` launches and shows placeholder window (will need display or can run headless check)
3. All source files exist in correct locations
4. CMakeLists.txt links Qt5::Widgets and Qt5::Network
5. TaskModel can be instantiated and basic operations work
6. AppSettings::configFilePath() returns ~/.config/remarkable-todoist/config.ini pattern
</verification>

<success_criteria>
- Qt 5.15 project compiles successfully
- Directory structure matches: src/models/, src/views/, src/controllers/, src/network/, src/config/
- Task struct has all required fields (id, title, projectId, projectName, dueDate, priority, completed)
- TaskModel inherits QAbstractListModel with correct role enum
- AppSettings provides token storage with file permissions
- .gitignore excludes config files and build artifacts
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-task-display/01-01-SUMMARY.md`
</output>
